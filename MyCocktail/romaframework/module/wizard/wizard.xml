<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="add-module" name="roma-mycocktail-wizard">
  <property environment="env" />
  <property name="roma.home" value="${env.ROMA_HOME}" />

  <import file="${roma.home}/common/wizard/base-wizard.xml" />

  <target name="add-module" depends="load-project-info, create-table, create-table2">
    <echo>Adding MyCocktail servlerts to project's web.xml -></echo>
    <xmltask source="servlets.xml">
        <copy path="/servlets/servlet" buffer="servlets" append="true" />
    </xmltask>
    <xmltask source="mappings.xml">
        <copy path="/mappings/servlet-mapping" buffer="mappings" append="true" />
    </xmltask>
    <xmltask source="${project.path}/WebContent/WEB-INF/web.xml" dest="${project.path}/WebContent/WEB-INF/web.xml" preservetype="true"
      outputter="${ident}">
      <xmlcatalog refid="dtds" />
      <insert path="/web-app/servlet[last()]"         position="after" buffer="servlets" />
      <insert path="/web-app/servlet-mapping[last()]" position="after" buffer="mappings" />
    </xmltask>
    
  </target>
  <target name="check-testdb.log">
    <available file="${project.path}/database/testdb.log" property="testdb.log-present"/>
  </target>
  <target name="create-table" depends="check-testdb.log" if="testdb.log-present">
    <echo file="${project.path}/database/testdb.log" append="true" >
<![CDATA[
CREATE MEMORY TABLE MASHUPS(ID INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 10) NOT NULL PRIMARY KEY,NAME VARCHAR(255),DESCRIPTION VARCHAR(255),JSON VARCHAR(255))
CREATE MEMORY TABLE PAGES  (ID INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 10) NOT NULL PRIMARY KEY,NAME VARCHAR(255),DESCRIPTION VARCHAR(255),JSON VARCHAR(255))
]]>
    </echo>
  </target>
  <target name="create-table2" depends="check-testdb.log" unless="testdb.log-present">
    <mkdir dir="${project.path}/database" />
    <echo file="${project.path}/database/testdb.log">
<![CDATA[
CREATE MEMORY TABLE MASHUPS(ID INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 10) NOT NULL PRIMARY KEY,NAME VARCHAR(255),DESCRIPTION VARCHAR(255),JSON VARCHAR(255))
CREATE MEMORY TABLE PAGES  (ID INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 10) NOT NULL PRIMARY KEY,NAME VARCHAR(255),DESCRIPTION VARCHAR(255),JSON VARCHAR(255))
]]>
    </echo>
  </target>
</project>